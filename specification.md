# 2025年Slack活動サマリーツール開発仕様書 (v2)

## 1. 概要

Slackの自分自身の投稿ログをAIで解析し、週次・月次・年次の階層的なサマリーを作成・蓄積するツール。すべてのサマリーを自身のDM内の一つのスレッドに集約し、最終的な年間サマリーのみ「チャンネルにも同時投稿」の形式で出力する。

## 2. システム構成

| 項目 | 内容 |
| --- | --- |
| ランタイム | Cloudflare Workers / Node.js |
| 言語・フレームワーク | TypeScript + Hono |
| インターフェース | Slack Slash Command (例: `/summarize-2025`) |

### 主要ライブラリ

- **@slack/hono** - Slack APIハンドリング
- **Vercel AI SDK (v5以上)** - LLM呼び出し (`generateText` 等)
- **zod** - AI出力のスキーマ定義およびバリデーション

### データ管理

SlackのスレッドをDBとして利用

## 3. 処理・ロジック詳細

### A. 週次サマリー (Weekly Summary)

| 項目 | 内容 |
| --- | --- |
| 期間判定 | 指定した週の開始日（月曜）〜終了日（日曜）を設定 |
| 情報保持 | サマリー内に「YYYY/MM/DD 〜 YYYY/MM/DD」の期間情報を明記する |
| 収集 | 期間内の自分の投稿を取得し、AIで要約 |
| 投稿 | DMスレッドに `[WeeklySummary_2025]` タグを付けて返信 |

### B. 月次サマリー (Monthly Summary)

**対象週の抽出条件:**

> **「その月の期間が1日でも含まれている週次サマリー」** をすべて対象とする。
>
> 例: 1/27(月)〜2/2(日)の週次サマリーは、1月の月次サマリーと2月の月次サマリーの両方に計算対象として含まれる。

| 項目 | 内容 |
| --- | --- |
| 集計 | スレッドから抽出した対象週のサマリー群をAIに入力し、1ヶ月の振り返りを作成 |
| 投稿 | DMスレッドに `[MonthlySummary_2025]` タグを付けて返信 |

### C. 年次サマリー (Yearly Summary)

| 項目 | 内容 |
| --- | --- |
| 集計 | 1月〜12月の月次サマリー（計12個）をAIに入力し、年間の成果を抽出 |
| 投稿 | `reply_broadcast: true` を設定し、スレッドに返信しつつチャンネルにも同時表示させる |

## 4. 技術的実装要件

| 要件 | 詳細 |
| --- | --- |
| 型安全 | Zodを用いたAIレスポンスのパース。Vercel AI SDKの `object` 生成機能を活用 |
| 非同期処理 | Honoの `c.executionCtx.waitUntil` を利用し、Slackの3秒レスポンスルールを回避 |
| Slack API | `conversations.replies` を用いてスレッド内からタグベースで過去サマリーを回収 |
